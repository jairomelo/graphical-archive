import{b as vn,d as Qn,aU as _n,j as de,h as vt,g as Jn,O as jn,I as R,a7 as tr,Q as er,R as nr,S as qe,i as pe,k as Tt,C as rr,aR as ir,q as Me,v as or,aV as ue,aW as ce,l as ar,az as We,Z as Qt,ar as Ge,aP as wn,aX as sr,m as xn,o as ur,aY as cr,aZ as me,y as fr,n as bn,a_ as lr,e as hr,a$ as gr,aO as dr,b0 as pr,a5 as mr,a1 as yr,W as vr,b1 as $e,b2 as Ft,p as _r,aj as wr,b3 as xr,ak as Yt,al as br,a as Mr,J as ft,$ as ye}from"./jSjl92EV.js";import{f as Nr,a as kr}from"./KPJj-mqH.js";import{i as Ar}from"./ep0KO6KW.js";import{p as nt,b as Sr}from"./B4B1MT23.js";function js(t,e){return e}function Er(t,e,n){for(var r=t.items,i=[],o=e.length,a=0;a<o;a++)gr(e[a].e,i,!0);var u=o>0&&i.length===0&&n!==null;if(u){var f=n.parentNode;dr(f),f.append(n),r.clear(),st(t,e[0].prev,e[o-1].next)}pr(i,()=>{for(var s=0;s<o;s++){var c=e[s];u||(r.delete(c.k),st(t,c.prev,c.next)),bn(c.e,!u)}})}function tu(t,e,n,r,i,o=null){var a=t,u={flags:e,items:new Map,first:null},f=(e&_n)!==0;if(f){var s=t;a=vt?de(Jn(s)):s.appendChild(vn())}vt&&jn();var c=null,v=!1,h=new Map,d=tr(()=>{var g=n();return sr(g)?g:g==null?[]:wn(g)}),_,y;function l(){Tr(y,_,u,h,a,i,e,r,n),o!==null&&(_.length===0?c?xn(c):c=Me(()=>o(a)):c!==null&&ur(c,()=>{c=null}))}Qn(()=>{y??=mr,_=R(d);var g=_.length;if(v&&g===0)return;v=g===0;let b=!1;if(vt){var S=er(a)===nr;S!==(g===0)&&(a=qe(),de(a),pe(!1),b=!0)}if(vt){for(var p=null,k,M=0;M<g;M++){if(Tt.nodeType===rr&&Tt.data===ir){a=Tt,b=!0,pe(!1);break}var N=_[M],z=r(N,M);k=Ne(Tt,u,p,null,N,z,M,i,e,n),u.items.set(z,k),p=k}g>0&&de(qe())}if(vt)g===0&&o&&(c=Me(()=>o(a)));else if(or()){var L=new Set,P=ar;for(M=0;M<g;M+=1){N=_[M],z=r(N,M);var O=u.items.get(z)??h.get(z);O?(e&(ue|ce))!==0&&Mn(O,N,M,e):(k=Ne(null,u,null,null,N,z,M,i,e,n,!0),h.set(z,k)),L.add(z)}for(const[Y,W]of u.items)L.has(Y)||P.skipped_effects.add(W.e);P.oncommit(l)}else l();b&&pe(!0),R(d)}),vt&&(a=Tt)}function Tr(t,e,n,r,i,o,a,u,f){var s=(a&lr)!==0,c=(a&(ue|ce))!==0,v=e.length,h=n.items,d=n.first,_=d,y,l=null,g,b=[],S=[],p,k,M,N;if(s)for(N=0;N<v;N+=1)p=e[N],k=u(p,N),M=h.get(k),M!==void 0&&(M.a?.measure(),(g??=new Set).add(M));for(N=0;N<v;N+=1){if(p=e[N],k=u(p,N),M=h.get(k),M===void 0){var z=r.get(k);if(z!==void 0){r.delete(k),h.set(k,z);var L=l?l.next:_;st(n,l,z),st(n,z,L),ve(z,L,i),l=z}else{var P=_?_.e.nodes_start:i;l=Ne(P,n,l,l===null?n.first:l.next,p,k,N,o,a,f)}h.set(k,l),b=[],S=[],_=l.next;continue}if(c&&Mn(M,p,N,a),(M.e.f&me)!==0&&(xn(M.e),s&&(M.a?.unfix(),(g??=new Set).delete(M))),M!==_){if(y!==void 0&&y.has(M)){if(b.length<S.length){var O=S[0],Y;l=O.prev;var W=b[0],m=b[b.length-1];for(Y=0;Y<b.length;Y+=1)ve(b[Y],O,i);for(Y=0;Y<S.length;Y+=1)y.delete(S[Y]);st(n,W.prev,m.next),st(n,l,W),st(n,m,O),_=O,l=m,N-=1,b=[],S=[]}else y.delete(M),ve(M,_,i),st(n,M.prev,M.next),st(n,M,l===null?n.first:l.next),st(n,l,M),l=M;continue}for(b=[],S=[];_!==null&&_.k!==k;)(_.e.f&me)===0&&(y??=new Set).add(_),S.push(_),_=_.next;if(_===null)continue;M=_}b.push(M),l=M,_=M.next}if(_!==null||y!==void 0){for(var E=y===void 0?[]:wn(y);_!==null;)(_.e.f&me)===0&&E.push(_),_=_.next;var x=E.length;if(x>0){var T=(a&_n)!==0&&v===0?i:null;if(s){for(N=0;N<x;N+=1)E[N].a?.measure();for(N=0;N<x;N+=1)E[N].a?.fix()}Er(n,E,T)}}s&&fr(()=>{if(g!==void 0)for(M of g)M.a?.apply()}),t.first=n.first&&n.first.e,t.last=l&&l.e;for(var $ of r.values())bn($.e);r.clear()}function Mn(t,e,n,r){(r&ue)!==0&&We(t.v,e),(r&ce)!==0?We(t.i,n):t.i=n}function Ne(t,e,n,r,i,o,a,u,f,s,c){var v=(f&ue)!==0,h=(f&cr)===0,d=v?h?Qt(i,!1,!1):Ge(i):i,_=(f&ce)===0?a:Ge(a),y={i:_,v:d,k:o,a:null,e:null,prev:n,next:r};try{if(t===null){var l=document.createDocumentFragment();l.append(t=vn())}return y.e=Me(()=>u(t,d,_,s),vt),y.e.prev=n&&n.e,y.e.next=r&&r.e,n===null?c||(e.first=y):(n.next=y,n.e.next=y.e),r!==null&&(r.prev=y,r.e.prev=y.e),y}finally{}}function ve(t,e,n){for(var r=t.next?t.next.e.nodes_start:n,i=e?e.e.nodes_start:n,o=t.e.nodes_start;o!==null&&o!==r;){var a=hr(o);i.before(o),o=a}}function st(t,e,n){e===null?t.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function Ue(t,e,n){var r=yr(t,e);r&&r.set&&(t[e]=n,vr(()=>{t[e]=null}))}const zr=Ft([]),Cr=$e(zr,t=>{const e=new Map;for(const n of t)e.set(n.id,n);return e}),Ir=Ft([]),$r=Ft(null),eu=Ft({});$e([$r,Ir,Cr],([t,e,n])=>t?e.filter(r=>r.source===t||r.target===t).map(r=>({id:r.source===t?r.target:r.source,score:r.score,item:n.get(r.source===t?r.target:r.source)})).filter(r=>r.item).sort((r,i)=>i.score-r.score):[]);function Rr(){if(typeof window>"u")return{views:new Set,bookmarks:new Set,viewTimestamps:new Map,hoverTimestamps:new Map};try{const t=sessionStorage.getItem("europeana_user_interactions");if(!t)return{views:new Set,bookmarks:new Set,viewTimestamps:new Map,hoverTimestamps:new Map};const e=JSON.parse(t);return{views:new Set(e.views||[]),bookmarks:new Set(e.bookmarks||[]),viewTimestamps:new Map(e.viewTimestamps||[]),hoverTimestamps:new Map(e.hoverTimestamps||[])}}catch{return{views:new Set,bookmarks:new Set,viewTimestamps:new Map,hoverTimestamps:new Map}}}function qt(t){if(!(typeof window>"u"))try{sessionStorage.setItem("europeana_user_interactions",JSON.stringify({views:Array.from(t.views),bookmarks:Array.from(t.bookmarks),viewTimestamps:Array.from(t.viewTimestamps.entries()),hoverTimestamps:Array.from((t.hoverTimestamps||new Map).entries())}))}catch(e){console.warn("Failed to save interactions:",e)}}function Dr(){const{subscribe:t,update:e}=Ft(Rr());return{subscribe:t,trackView:n=>e(r=>{r.views.add(n);const i=r.viewTimestamps.get(n)||[];return i.push(Date.now()),r.viewTimestamps.set(n,i),qt(r),r}),trackHover:n=>e(r=>{r.hoverTimestamps=r.hoverTimestamps||new Map;const i=r.hoverTimestamps.get(n)||[];return i.push(Date.now()),r.hoverTimestamps.set(n,i),qt(r),r}),toggleBookmark:n=>e(r=>(r.bookmarks.has(n)?r.bookmarks.delete(n):r.bookmarks.add(n),qt(r),r)),reset:()=>e(()=>{const n={views:new Set,bookmarks:new Set,viewTimestamps:new Map,hoverTimestamps:new Map};return qt(n),n})}}const Hr=Dr(),nu=$e([Hr],([t])=>{Array.from(t.views);const e=Array.from(t.bookmarks),n=new Map,r=new Map,i=Array.from(t.viewTimestamps.entries()).sort((s,c)=>{const v=s[1][s[1].length-1]||0,h=c[1][c[1].length-1]||0;return v-h}).map(s=>s[0]),o=5;for(let s=0;s<i.length;s++)for(let c=s+1;c<Math.min(s+o,i.length);c++){const v=[i[s],i[c]].sort().join("|");n.set(v,(n.get(v)||0)+1)}for(let s=0;s<e.length;s++)for(let c=s+1;c<e.length;c++){const v=[e[s],e[c]].sort().join("|");r.set(v,(r.get(v)||0)+1)}const a=new Map,u=Math.max(1,...Array.from(n.values())),f=Math.max(1,...Array.from(r.values()));return n.forEach((s,c)=>{a.set(c,(a.get(c)||0)+.4*(s/u))}),r.forEach((s,c)=>{a.set(c,(a.get(c)||0)+.6*(s/f))}),a});var Pr={value:()=>{}};function Lt(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Jt(n)}function Jt(t){this._=t}function Xr(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Jt.prototype=Lt.prototype={constructor:Jt,on:function(t,e){var n=this._,r=Xr(t+"",n),i,o=-1,a=r.length;if(arguments.length<2){for(;++o<a;)if((i=(t=r[o]).type)&&(i=Fr(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<a;)if(i=(t=r[o]).type)n[i]=Ke(n[i],t.name,e);else if(e==null)for(i in n)n[i]=Ke(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Jt(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,o;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],r=0,i=o.length;r<i;++r)o[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};function Fr(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function Ke(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Pr,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var ke="http://www.w3.org/1999/xhtml";const Ze={svg:"http://www.w3.org/2000/svg",xhtml:ke,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function fe(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Ze.hasOwnProperty(e)?{space:Ze[e],local:t}:t}function Lr(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===ke&&e.documentElement.namespaceURI===ke?e.createElement(t):e.createElementNS(n,t)}}function Or(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Nn(t){var e=fe(t);return(e.local?Or:Lr)(e)}function Br(){}function Re(t){return t==null?Br:function(){return this.querySelector(t)}}function Vr(t){typeof t!="function"&&(t=Re(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],a=o.length,u=r[i]=new Array(a),f,s,c=0;c<a;++c)(f=o[c])&&(s=t.call(f,f.__data__,c,o))&&("__data__"in f&&(s.__data__=f.__data__),u[c]=s);return new rt(r,this._parents)}function Yr(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function qr(){return[]}function kn(t){return t==null?qr:function(){return this.querySelectorAll(t)}}function Wr(t){return function(){return Yr(t.apply(this,arguments))}}function Gr(t){typeof t=="function"?t=Wr(t):t=kn(t);for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var a=e[o],u=a.length,f,s=0;s<u;++s)(f=a[s])&&(r.push(t.call(f,f.__data__,s,a)),i.push(f));return new rt(r,i)}function An(t){return function(){return this.matches(t)}}function Sn(t){return function(e){return e.matches(t)}}var Ur=Array.prototype.find;function Kr(t){return function(){return Ur.call(this.children,t)}}function Zr(){return this.firstElementChild}function Qr(t){return this.select(t==null?Zr:Kr(typeof t=="function"?t:Sn(t)))}var Jr=Array.prototype.filter;function jr(){return Array.from(this.children)}function ti(t){return function(){return Jr.call(this.children,t)}}function ei(t){return this.selectAll(t==null?jr:ti(typeof t=="function"?t:Sn(t)))}function ni(t){typeof t!="function"&&(t=An(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],a=o.length,u=r[i]=[],f,s=0;s<a;++s)(f=o[s])&&t.call(f,f.__data__,s,o)&&u.push(f);return new rt(r,this._parents)}function En(t){return new Array(t.length)}function ri(){return new rt(this._enter||this._groups.map(En),this._parents)}function ne(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}ne.prototype={constructor:ne,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function ii(t){return function(){return t}}function oi(t,e,n,r,i,o){for(var a=0,u,f=e.length,s=o.length;a<s;++a)(u=e[a])?(u.__data__=o[a],r[a]=u):n[a]=new ne(t,o[a]);for(;a<f;++a)(u=e[a])&&(i[a]=u)}function ai(t,e,n,r,i,o,a){var u,f,s=new Map,c=e.length,v=o.length,h=new Array(c),d;for(u=0;u<c;++u)(f=e[u])&&(h[u]=d=a.call(f,f.__data__,u,e)+"",s.has(d)?i[u]=f:s.set(d,f));for(u=0;u<v;++u)d=a.call(t,o[u],u,o)+"",(f=s.get(d))?(r[u]=f,f.__data__=o[u],s.delete(d)):n[u]=new ne(t,o[u]);for(u=0;u<c;++u)(f=e[u])&&s.get(h[u])===f&&(i[u]=f)}function si(t){return t.__data__}function ui(t,e){if(!arguments.length)return Array.from(this,si);var n=e?ai:oi,r=this._parents,i=this._groups;typeof t!="function"&&(t=ii(t));for(var o=i.length,a=new Array(o),u=new Array(o),f=new Array(o),s=0;s<o;++s){var c=r[s],v=i[s],h=v.length,d=ci(t.call(c,c&&c.__data__,s,r)),_=d.length,y=u[s]=new Array(_),l=a[s]=new Array(_),g=f[s]=new Array(h);n(c,v,y,l,g,d,e);for(var b=0,S=0,p,k;b<_;++b)if(p=y[b]){for(b>=S&&(S=b+1);!(k=l[S])&&++S<_;);p._next=k||null}}return a=new rt(a,r),a._enter=u,a._exit=f,a}function ci(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function fi(){return new rt(this._exit||this._groups.map(En),this._parents)}function li(t,e,n){var r=this.enter(),i=this,o=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?o.remove():n(o),r&&i?r.merge(i).order():i}function hi(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,o=r.length,a=Math.min(i,o),u=new Array(i),f=0;f<a;++f)for(var s=n[f],c=r[f],v=s.length,h=u[f]=new Array(v),d,_=0;_<v;++_)(d=s[_]||c[_])&&(h[_]=d);for(;f<i;++f)u[f]=n[f];return new rt(u,this._parents)}function gi(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,o=r[i],a;--i>=0;)(a=r[i])&&(o&&a.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(a,o),o=a);return this}function di(t){t||(t=pi);function e(v,h){return v&&h?t(v.__data__,h.__data__):!v-!h}for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a=n[o],u=a.length,f=i[o]=new Array(u),s,c=0;c<u;++c)(s=a[c])&&(f[c]=s);f.sort(e)}return new rt(i,this._parents).order()}function pi(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function mi(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function yi(){return Array.from(this)}function vi(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null}function _i(){let t=0;for(const e of this)++t;return t}function wi(){return!this.node()}function xi(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],o=0,a=i.length,u;o<a;++o)(u=i[o])&&t.call(u,u.__data__,o,i);return this}function bi(t){return function(){this.removeAttribute(t)}}function Mi(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ni(t,e){return function(){this.setAttribute(t,e)}}function ki(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Ai(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Si(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Ei(t,e){var n=fe(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?Mi:bi:typeof e=="function"?n.local?Si:Ai:n.local?ki:Ni)(n,e))}function Tn(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Ti(t){return function(){this.style.removeProperty(t)}}function zi(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Ci(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Ii(t,e,n){return arguments.length>1?this.each((e==null?Ti:typeof e=="function"?Ci:zi)(t,e,n??"")):kt(this.node(),t)}function kt(t,e){return t.style.getPropertyValue(e)||Tn(t).getComputedStyle(t,null).getPropertyValue(e)}function $i(t){return function(){delete this[t]}}function Ri(t,e){return function(){this[t]=e}}function Di(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Hi(t,e){return arguments.length>1?this.each((e==null?$i:typeof e=="function"?Di:Ri)(t,e)):this.node()[t]}function zn(t){return t.trim().split(/^|\s+/)}function De(t){return t.classList||new Cn(t)}function Cn(t){this._node=t,this._names=zn(t.getAttribute("class")||"")}Cn.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function In(t,e){for(var n=De(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function $n(t,e){for(var n=De(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function Pi(t){return function(){In(this,t)}}function Xi(t){return function(){$n(this,t)}}function Fi(t,e){return function(){(e.apply(this,arguments)?In:$n)(this,t)}}function Li(t,e){var n=zn(t+"");if(arguments.length<2){for(var r=De(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?Fi:e?Pi:Xi)(n,e))}function Oi(){this.textContent=""}function Bi(t){return function(){this.textContent=t}}function Vi(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Yi(t){return arguments.length?this.each(t==null?Oi:(typeof t=="function"?Vi:Bi)(t)):this.node().textContent}function qi(){this.innerHTML=""}function Wi(t){return function(){this.innerHTML=t}}function Gi(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Ui(t){return arguments.length?this.each(t==null?qi:(typeof t=="function"?Gi:Wi)(t)):this.node().innerHTML}function Ki(){this.nextSibling&&this.parentNode.appendChild(this)}function Zi(){return this.each(Ki)}function Qi(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ji(){return this.each(Qi)}function ji(t){var e=typeof t=="function"?t:Nn(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function to(){return null}function eo(t,e){var n=typeof t=="function"?t:Nn(t),r=e==null?to:typeof e=="function"?e:Re(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function no(){var t=this.parentNode;t&&t.removeChild(this)}function ro(){return this.each(no)}function io(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function oo(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ao(t){return this.select(t?oo:io)}function so(t){return arguments.length?this.property("__data__",t):this.node().__data__}function uo(t){return function(e){t.call(this,e,this.__data__)}}function co(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function fo(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,o;n<i;++n)o=e[n],(!t.type||o.type===t.type)&&o.name===t.name?this.removeEventListener(o.type,o.listener,o.options):e[++r]=o;++r?e.length=r:delete this.__on}}}function lo(t,e,n){return function(){var r=this.__on,i,o=uo(e);if(r){for(var a=0,u=r.length;a<u;++a)if((i=r[a]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),i.value=e;return}}this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function ho(t,e,n){var r=co(t+""),i,o=r.length,a;if(arguments.length<2){var u=this.node().__on;if(u){for(var f=0,s=u.length,c;f<s;++f)for(i=0,c=u[f];i<o;++i)if((a=r[i]).type===c.type&&a.name===c.name)return c.value}return}for(u=e?lo:fo,i=0;i<o;++i)this.each(u(r[i],e,n));return this}function Rn(t,e,n){var r=Tn(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function go(t,e){return function(){return Rn(this,t,e)}}function po(t,e){return function(){return Rn(this,t,e.apply(this,arguments))}}function mo(t,e){return this.each((typeof e=="function"?po:go)(t,e))}function*yo(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length,a;i<o;++i)(a=r[i])&&(yield a)}var Dn=[null];function rt(t,e){this._groups=t,this._parents=e}function Ot(){return new rt([[document.documentElement]],Dn)}function vo(){return this}rt.prototype=Ot.prototype={constructor:rt,select:Vr,selectAll:Gr,selectChild:Qr,selectChildren:ei,filter:ni,data:ui,enter:ri,exit:fi,join:li,merge:hi,selection:vo,order:gi,sort:di,call:mi,nodes:yi,node:vi,size:_i,empty:wi,each:xi,attr:Ei,style:Ii,property:Hi,classed:Li,text:Yi,html:Ui,raise:Zi,lower:Ji,append:ji,insert:eo,remove:ro,clone:ao,datum:so,on:ho,dispatch:mo,[Symbol.iterator]:yo};function J(t){return typeof t=="string"?new rt([[document.querySelector(t)]],[document.documentElement]):new rt([[t]],Dn)}function _o(t){let e;for(;e=t.sourceEvent;)t=e;return t}function ht(t,e){if(t=_o(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}const wo={passive:!1},Rt={capture:!0,passive:!1};function _e(t){t.stopImmediatePropagation()}function Mt(t){t.preventDefault(),t.stopImmediatePropagation()}function Hn(t){var e=t.document.documentElement,n=J(t).on("dragstart.drag",Mt,Rt);"onselectstart"in e?n.on("selectstart.drag",Mt,Rt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Pn(t,e){var n=t.document.documentElement,r=J(t).on("dragstart.drag",null);e&&(r.on("click.drag",Mt,Rt),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Wt=t=>()=>t;function Ae(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:o,x:a,y:u,dx:f,dy:s,dispatch:c}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:u,enumerable:!0,configurable:!0},dx:{value:f,enumerable:!0,configurable:!0},dy:{value:s,enumerable:!0,configurable:!0},_:{value:c}})}Ae.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function xo(t){return!t.ctrlKey&&!t.button}function bo(){return this.parentNode}function Mo(t,e){return e??{x:t.x,y:t.y}}function No(){return navigator.maxTouchPoints||"ontouchstart"in this}function ko(){var t=xo,e=bo,n=Mo,r=No,i={},o=Lt("start","drag","end"),a=0,u,f,s,c,v=0;function h(p){p.on("mousedown.drag",d).filter(r).on("touchstart.drag",l).on("touchmove.drag",g,wo).on("touchend.drag touchcancel.drag",b).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(p,k){if(!(c||!t.call(this,p,k))){var M=S(this,e.call(this,p,k),p,k,"mouse");M&&(J(p.view).on("mousemove.drag",_,Rt).on("mouseup.drag",y,Rt),Hn(p.view),_e(p),s=!1,u=p.clientX,f=p.clientY,M("start",p))}}function _(p){if(Mt(p),!s){var k=p.clientX-u,M=p.clientY-f;s=k*k+M*M>v}i.mouse("drag",p)}function y(p){J(p.view).on("mousemove.drag mouseup.drag",null),Pn(p.view,s),Mt(p),i.mouse("end",p)}function l(p,k){if(t.call(this,p,k)){var M=p.changedTouches,N=e.call(this,p,k),z=M.length,L,P;for(L=0;L<z;++L)(P=S(this,N,p,k,M[L].identifier,M[L]))&&(_e(p),P("start",p,M[L]))}}function g(p){var k=p.changedTouches,M=k.length,N,z;for(N=0;N<M;++N)(z=i[k[N].identifier])&&(Mt(p),z("drag",p,k[N]))}function b(p){var k=p.changedTouches,M=k.length,N,z;for(c&&clearTimeout(c),c=setTimeout(function(){c=null},500),N=0;N<M;++N)(z=i[k[N].identifier])&&(_e(p),z("end",p,k[N]))}function S(p,k,M,N,z,L){var P=o.copy(),O=ht(L||M,k),Y,W,m;if((m=n.call(p,new Ae("beforestart",{sourceEvent:M,target:h,identifier:z,active:a,x:O[0],y:O[1],dx:0,dy:0,dispatch:P}),N))!=null)return Y=m.x-O[0]||0,W=m.y-O[1]||0,function E(x,T,$){var D=O,H;switch(x){case"start":i[z]=E,H=a++;break;case"end":delete i[z],--a;case"drag":O=ht($||T,k),H=a;break}P.call(x,p,new Ae(x,{sourceEvent:T,subject:m,target:h,identifier:z,active:H,x:O[0]+Y,y:O[1]+W,dx:O[0]-D[0],dy:O[1]-D[1],dispatch:P}),N)}}return h.filter=function(p){return arguments.length?(t=typeof p=="function"?p:Wt(!!p),h):t},h.container=function(p){return arguments.length?(e=typeof p=="function"?p:Wt(p),h):e},h.subject=function(p){return arguments.length?(n=typeof p=="function"?p:Wt(p),h):n},h.touchable=function(p){return arguments.length?(r=typeof p=="function"?p:Wt(!!p),h):r},h.on=function(){var p=o.on.apply(o,arguments);return p===o?h:p},h.clickDistance=function(p){return arguments.length?(v=(p=+p)*p,h):Math.sqrt(v)},h}function He(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Xn(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Bt(){}var Dt=.7,re=1/Dt,Nt="\\s*([+-]?\\d+)\\s*",Ht="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ut="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ao=/^#([0-9a-f]{3,8})$/,So=new RegExp(`^rgb\\(${Nt},${Nt},${Nt}\\)$`),Eo=new RegExp(`^rgb\\(${ut},${ut},${ut}\\)$`),To=new RegExp(`^rgba\\(${Nt},${Nt},${Nt},${Ht}\\)$`),zo=new RegExp(`^rgba\\(${ut},${ut},${ut},${Ht}\\)$`),Co=new RegExp(`^hsl\\(${Ht},${ut},${ut}\\)$`),Io=new RegExp(`^hsla\\(${Ht},${ut},${ut},${Ht}\\)$`),Qe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};He(Bt,Pt,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Je,formatHex:Je,formatHex8:$o,formatHsl:Ro,formatRgb:je,toString:je});function Je(){return this.rgb().formatHex()}function $o(){return this.rgb().formatHex8()}function Ro(){return Fn(this).formatHsl()}function je(){return this.rgb().formatRgb()}function Pt(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Ao.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?tn(e):n===3?new j(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Gt(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Gt(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=So.exec(t))?new j(e[1],e[2],e[3],1):(e=Eo.exec(t))?new j(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=To.exec(t))?Gt(e[1],e[2],e[3],e[4]):(e=zo.exec(t))?Gt(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Co.exec(t))?rn(e[1],e[2]/100,e[3]/100,1):(e=Io.exec(t))?rn(e[1],e[2]/100,e[3]/100,e[4]):Qe.hasOwnProperty(t)?tn(Qe[t]):t==="transparent"?new j(NaN,NaN,NaN,0):null}function tn(t){return new j(t>>16&255,t>>8&255,t&255,1)}function Gt(t,e,n,r){return r<=0&&(t=e=n=NaN),new j(t,e,n,r)}function Do(t){return t instanceof Bt||(t=Pt(t)),t?(t=t.rgb(),new j(t.r,t.g,t.b,t.opacity)):new j}function Se(t,e,n,r){return arguments.length===1?Do(t):new j(t,e,n,r??1)}function j(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}He(j,Se,Xn(Bt,{brighter(t){return t=t==null?re:Math.pow(re,t),new j(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Dt:Math.pow(Dt,t),new j(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new j(wt(this.r),wt(this.g),wt(this.b),ie(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:en,formatHex:en,formatHex8:Ho,formatRgb:nn,toString:nn}));function en(){return`#${_t(this.r)}${_t(this.g)}${_t(this.b)}`}function Ho(){return`#${_t(this.r)}${_t(this.g)}${_t(this.b)}${_t((isNaN(this.opacity)?1:this.opacity)*255)}`}function nn(){const t=ie(this.opacity);return`${t===1?"rgb(":"rgba("}${wt(this.r)}, ${wt(this.g)}, ${wt(this.b)}${t===1?")":`, ${t})`}`}function ie(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function wt(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function _t(t){return t=wt(t),(t<16?"0":"")+t.toString(16)}function rn(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new ot(t,e,n,r)}function Fn(t){if(t instanceof ot)return new ot(t.h,t.s,t.l,t.opacity);if(t instanceof Bt||(t=Pt(t)),!t)return new ot;if(t instanceof ot)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,u=o-i,f=(o+i)/2;return u?(e===o?a=(n-r)/u+(n<r)*6:n===o?a=(r-e)/u+2:a=(e-n)/u+4,u/=f<.5?o+i:2-o-i,a*=60):u=f>0&&f<1?0:a,new ot(a,u,f,t.opacity)}function Po(t,e,n,r){return arguments.length===1?Fn(t):new ot(t,e,n,r??1)}function ot(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}He(ot,Po,Xn(Bt,{brighter(t){return t=t==null?re:Math.pow(re,t),new ot(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Dt:Math.pow(Dt,t),new ot(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new j(we(t>=240?t-240:t+120,i,r),we(t,i,r),we(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new ot(on(this.h),Ut(this.s),Ut(this.l),ie(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=ie(this.opacity);return`${t===1?"hsl(":"hsla("}${on(this.h)}, ${Ut(this.s)*100}%, ${Ut(this.l)*100}%${t===1?")":`, ${t})`}`}}));function on(t){return t=(t||0)%360,t<0?t+360:t}function Ut(t){return Math.max(0,Math.min(1,t||0))}function we(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Ln=t=>()=>t;function Xo(t,e){return function(n){return t+n*e}}function Fo(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function Lo(t){return(t=+t)==1?On:function(e,n){return n-e?Fo(e,n,t):Ln(isNaN(e)?n:e)}}function On(t,e){var n=e-t;return n?Xo(t,n):Ln(isNaN(t)?e:t)}const an=(function t(e){var n=Lo(e);function r(i,o){var a=n((i=Se(i)).r,(o=Se(o)).r),u=n(i.g,o.g),f=n(i.b,o.b),s=On(i.opacity,o.opacity);return function(c){return i.r=a(c),i.g=u(c),i.b=f(c),i.opacity=s(c),i+""}}return r.gamma=t,r})(1);function mt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var Ee=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,xe=new RegExp(Ee.source,"g");function Oo(t){return function(){return t}}function Bo(t){return function(e){return t(e)+""}}function Vo(t,e){var n=Ee.lastIndex=xe.lastIndex=0,r,i,o,a=-1,u=[],f=[];for(t=t+"",e=e+"";(r=Ee.exec(t))&&(i=xe.exec(e));)(o=i.index)>n&&(o=e.slice(n,o),u[a]?u[a]+=o:u[++a]=o),(r=r[0])===(i=i[0])?u[a]?u[a]+=i:u[++a]=i:(u[++a]=null,f.push({i:a,x:mt(r,i)})),n=xe.lastIndex;return n<e.length&&(o=e.slice(n),u[a]?u[a]+=o:u[++a]=o),u.length<2?f[0]?Bo(f[0].x):Oo(e):(e=f.length,function(s){for(var c=0,v;c<e;++c)u[(v=f[c]).i]=v.x(s);return u.join("")})}var sn=180/Math.PI,Te={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Bn(t,e,n,r,i,o){var a,u,f;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(f=t*n+e*r)&&(n-=t*f,r-=e*f),(u=Math.sqrt(n*n+r*r))&&(n/=u,r/=u,f/=u),t*r<e*n&&(t=-t,e=-e,f=-f,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*sn,skewX:Math.atan(f)*sn,scaleX:a,scaleY:u}}var Kt;function Yo(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Te:Bn(e.a,e.b,e.c,e.d,e.e,e.f)}function qo(t){return t==null||(Kt||(Kt=document.createElementNS("http://www.w3.org/2000/svg","g")),Kt.setAttribute("transform",t),!(t=Kt.transform.baseVal.consolidate()))?Te:(t=t.matrix,Bn(t.a,t.b,t.c,t.d,t.e,t.f))}function Vn(t,e,n,r){function i(s){return s.length?s.pop()+" ":""}function o(s,c,v,h,d,_){if(s!==v||c!==h){var y=d.push("translate(",null,e,null,n);_.push({i:y-4,x:mt(s,v)},{i:y-2,x:mt(c,h)})}else(v||h)&&d.push("translate("+v+e+h+n)}function a(s,c,v,h){s!==c?(s-c>180?c+=360:c-s>180&&(s+=360),h.push({i:v.push(i(v)+"rotate(",null,r)-2,x:mt(s,c)})):c&&v.push(i(v)+"rotate("+c+r)}function u(s,c,v,h){s!==c?h.push({i:v.push(i(v)+"skewX(",null,r)-2,x:mt(s,c)}):c&&v.push(i(v)+"skewX("+c+r)}function f(s,c,v,h,d,_){if(s!==v||c!==h){var y=d.push(i(d)+"scale(",null,",",null,")");_.push({i:y-4,x:mt(s,v)},{i:y-2,x:mt(c,h)})}else(v!==1||h!==1)&&d.push(i(d)+"scale("+v+","+h+")")}return function(s,c){var v=[],h=[];return s=t(s),c=t(c),o(s.translateX,s.translateY,c.translateX,c.translateY,v,h),a(s.rotate,c.rotate,v,h),u(s.skewX,c.skewX,v,h),f(s.scaleX,s.scaleY,c.scaleX,c.scaleY,v,h),s=c=null,function(d){for(var _=-1,y=h.length,l;++_<y;)v[(l=h[_]).i]=l.x(d);return v.join("")}}}var Wo=Vn(Yo,"px, ","px)","deg)"),Go=Vn(qo,", ",")",")"),Uo=1e-12;function un(t){return((t=Math.exp(t))+1/t)/2}function Ko(t){return((t=Math.exp(t))-1/t)/2}function Zo(t){return((t=Math.exp(2*t))-1)/(t+1)}const Qo=(function t(e,n,r){function i(o,a){var u=o[0],f=o[1],s=o[2],c=a[0],v=a[1],h=a[2],d=c-u,_=v-f,y=d*d+_*_,l,g;if(y<Uo)g=Math.log(h/s)/e,l=function(N){return[u+N*d,f+N*_,s*Math.exp(e*N*g)]};else{var b=Math.sqrt(y),S=(h*h-s*s+r*y)/(2*s*n*b),p=(h*h-s*s-r*y)/(2*h*n*b),k=Math.log(Math.sqrt(S*S+1)-S),M=Math.log(Math.sqrt(p*p+1)-p);g=(M-k)/e,l=function(N){var z=N*g,L=un(k),P=s/(n*b)*(L*Zo(e*z+k)-Ko(k));return[u+P*d,f+P*_,s*L/un(e*z+k)]}}return l.duration=g*1e3*e/Math.SQRT2,l}return i.rho=function(o){var a=Math.max(.001,+o),u=a*a,f=u*u;return t(a,u,f)},i})(Math.SQRT2,2,4);var At=0,It=0,zt=0,Yn=1e3,oe,$t,ae=0,bt=0,le=0,Xt=typeof performance=="object"&&performance.now?performance:Date,qn=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Pe(){return bt||(qn(Jo),bt=Xt.now()+le)}function Jo(){bt=0}function se(){this._call=this._time=this._next=null}se.prototype=Xe.prototype={constructor:se,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Pe():+n)+(e==null?0:+e),!this._next&&$t!==this&&($t?$t._next=this:oe=this,$t=this),this._call=t,this._time=n,ze()},stop:function(){this._call&&(this._call=null,this._time=1/0,ze())}};function Xe(t,e,n){var r=new se;return r.restart(t,e,n),r}function jo(){Pe(),++At;for(var t=oe,e;t;)(e=bt-t._time)>=0&&t._call.call(void 0,e),t=t._next;--At}function cn(){bt=(ae=Xt.now())+le,At=It=0;try{jo()}finally{At=0,ea(),bt=0}}function ta(){var t=Xt.now(),e=t-ae;e>Yn&&(le-=e,ae=t)}function ea(){for(var t,e=oe,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:oe=n);$t=t,ze(r)}function ze(t){if(!At){It&&(It=clearTimeout(It));var e=t-bt;e>24?(t<1/0&&(It=setTimeout(cn,t-Xt.now()-le)),zt&&(zt=clearInterval(zt))):(zt||(ae=Xt.now(),zt=setInterval(ta,Yn)),At=1,qn(cn))}}function fn(t,e,n){var r=new se;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var na=Lt("start","end","cancel","interrupt"),ra=[],Wn=0,ln=1,Ce=2,jt=3,hn=4,Ie=5,te=6;function he(t,e,n,r,i,o){var a=t.__transition;if(!a)t.__transition={};else if(n in a)return;ia(t,n,{name:e,index:r,group:i,on:na,tween:ra,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:Wn})}function Fe(t,e){var n=at(t,e);if(n.state>Wn)throw new Error("too late; already scheduled");return n}function ct(t,e){var n=at(t,e);if(n.state>jt)throw new Error("too late; already running");return n}function at(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function ia(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=Xe(o,0,n.time);function o(s){n.state=ln,n.timer.restart(a,n.delay,n.time),n.delay<=s&&a(s-n.delay)}function a(s){var c,v,h,d;if(n.state!==ln)return f();for(c in r)if(d=r[c],d.name===n.name){if(d.state===jt)return fn(a);d.state===hn?(d.state=te,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[c]):+c<e&&(d.state=te,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[c])}if(fn(function(){n.state===jt&&(n.state=hn,n.timer.restart(u,n.delay,n.time),u(s))}),n.state=Ce,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Ce){for(n.state=jt,i=new Array(h=n.tween.length),c=0,v=-1;c<h;++c)(d=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(i[++v]=d);i.length=v+1}}function u(s){for(var c=s<n.duration?n.ease.call(null,s/n.duration):(n.timer.restart(f),n.state=Ie,1),v=-1,h=i.length;++v<h;)i[v].call(t,c);n.state===Ie&&(n.on.call("end",t,t.__data__,n.index,n.group),f())}function f(){n.state=te,n.timer.stop(),delete r[e];for(var s in r)return;delete t.__transition}}function ee(t,e){var n=t.__transition,r,i,o=!0,a;if(n){e=e==null?null:e+"";for(a in n){if((r=n[a]).name!==e){o=!1;continue}i=r.state>Ce&&r.state<Ie,r.state=te,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[a]}o&&delete t.__transition}}function oa(t){return this.each(function(){ee(this,t)})}function aa(t,e){var n,r;return function(){var i=ct(this,t),o=i.tween;if(o!==n){r=n=o;for(var a=0,u=r.length;a<u;++a)if(r[a].name===e){r=r.slice(),r.splice(a,1);break}}i.tween=r}}function sa(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var o=ct(this,t),a=o.tween;if(a!==r){i=(r=a).slice();for(var u={name:e,value:n},f=0,s=i.length;f<s;++f)if(i[f].name===e){i[f]=u;break}f===s&&i.push(u)}o.tween=i}}function ua(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=at(this.node(),n).tween,i=0,o=r.length,a;i<o;++i)if((a=r[i]).name===t)return a.value;return null}return this.each((e==null?aa:sa)(n,t,e))}function Le(t,e,n){var r=t._id;return t.each(function(){var i=ct(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return at(i,r).value[e]}}function Gn(t,e){var n;return(typeof e=="number"?mt:e instanceof Pt?an:(n=Pt(e))?(e=n,an):Vo)(t,e)}function ca(t){return function(){this.removeAttribute(t)}}function fa(t){return function(){this.removeAttributeNS(t.space,t.local)}}function la(t,e,n){var r,i=n+"",o;return function(){var a=this.getAttribute(t);return a===i?null:a===r?o:o=e(r=a,n)}}function ha(t,e,n){var r,i=n+"",o;return function(){var a=this.getAttributeNS(t.space,t.local);return a===i?null:a===r?o:o=e(r=a,n)}}function ga(t,e,n){var r,i,o;return function(){var a,u=n(this),f;return u==null?void this.removeAttribute(t):(a=this.getAttribute(t),f=u+"",a===f?null:a===r&&f===i?o:(i=f,o=e(r=a,u)))}}function da(t,e,n){var r,i,o;return function(){var a,u=n(this),f;return u==null?void this.removeAttributeNS(t.space,t.local):(a=this.getAttributeNS(t.space,t.local),f=u+"",a===f?null:a===r&&f===i?o:(i=f,o=e(r=a,u)))}}function pa(t,e){var n=fe(t),r=n==="transform"?Go:Gn;return this.attrTween(t,typeof e=="function"?(n.local?da:ga)(n,r,Le(this,"attr."+t,e)):e==null?(n.local?fa:ca)(n):(n.local?ha:la)(n,r,e))}function ma(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function ya(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function va(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&ya(t,o)),n}return i._value=e,i}function _a(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&ma(t,o)),n}return i._value=e,i}function wa(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=fe(t);return this.tween(n,(r.local?va:_a)(r,e))}function xa(t,e){return function(){Fe(this,t).delay=+e.apply(this,arguments)}}function ba(t,e){return e=+e,function(){Fe(this,t).delay=e}}function Ma(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?xa:ba)(e,t)):at(this.node(),e).delay}function Na(t,e){return function(){ct(this,t).duration=+e.apply(this,arguments)}}function ka(t,e){return e=+e,function(){ct(this,t).duration=e}}function Aa(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Na:ka)(e,t)):at(this.node(),e).duration}function Sa(t,e){if(typeof e!="function")throw new Error;return function(){ct(this,t).ease=e}}function Ea(t){var e=this._id;return arguments.length?this.each(Sa(e,t)):at(this.node(),e).ease}function Ta(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;ct(this,t).ease=n}}function za(t){if(typeof t!="function")throw new Error;return this.each(Ta(this._id,t))}function Ca(t){typeof t!="function"&&(t=An(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],a=o.length,u=r[i]=[],f,s=0;s<a;++s)(f=o[s])&&t.call(f,f.__data__,s,o)&&u.push(f);return new dt(r,this._parents,this._name,this._id)}function Ia(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),u=0;u<o;++u)for(var f=e[u],s=n[u],c=f.length,v=a[u]=new Array(c),h,d=0;d<c;++d)(h=f[d]||s[d])&&(v[d]=h);for(;u<r;++u)a[u]=e[u];return new dt(a,this._parents,this._name,this._id)}function $a(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Ra(t,e,n){var r,i,o=$a(e)?Fe:ct;return function(){var a=o(this,t),u=a.on;u!==r&&(i=(r=u).copy()).on(e,n),a.on=i}}function Da(t,e){var n=this._id;return arguments.length<2?at(this.node(),n).on.on(t):this.each(Ra(n,t,e))}function Ha(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Pa(){return this.on("end.remove",Ha(this._id))}function Xa(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Re(t));for(var r=this._groups,i=r.length,o=new Array(i),a=0;a<i;++a)for(var u=r[a],f=u.length,s=o[a]=new Array(f),c,v,h=0;h<f;++h)(c=u[h])&&(v=t.call(c,c.__data__,h,u))&&("__data__"in c&&(v.__data__=c.__data__),s[h]=v,he(s[h],e,n,h,s,at(c,n)));return new dt(o,this._parents,e,n)}function Fa(t){var e=this._name,n=this._id;typeof t!="function"&&(t=kn(t));for(var r=this._groups,i=r.length,o=[],a=[],u=0;u<i;++u)for(var f=r[u],s=f.length,c,v=0;v<s;++v)if(c=f[v]){for(var h=t.call(c,c.__data__,v,f),d,_=at(c,n),y=0,l=h.length;y<l;++y)(d=h[y])&&he(d,e,n,y,h,_);o.push(h),a.push(c)}return new dt(o,a,e,n)}var La=Ot.prototype.constructor;function Oa(){return new La(this._groups,this._parents)}function Ba(t,e){var n,r,i;return function(){var o=kt(this,t),a=(this.style.removeProperty(t),kt(this,t));return o===a?null:o===n&&a===r?i:i=e(n=o,r=a)}}function Un(t){return function(){this.style.removeProperty(t)}}function Va(t,e,n){var r,i=n+"",o;return function(){var a=kt(this,t);return a===i?null:a===r?o:o=e(r=a,n)}}function Ya(t,e,n){var r,i,o;return function(){var a=kt(this,t),u=n(this),f=u+"";return u==null&&(f=u=(this.style.removeProperty(t),kt(this,t))),a===f?null:a===r&&f===i?o:(i=f,o=e(r=a,u))}}function qa(t,e){var n,r,i,o="style."+e,a="end."+o,u;return function(){var f=ct(this,t),s=f.on,c=f.value[o]==null?u||(u=Un(e)):void 0;(s!==n||i!==c)&&(r=(n=s).copy()).on(a,i=c),f.on=r}}function Wa(t,e,n){var r=(t+="")=="transform"?Wo:Gn;return e==null?this.styleTween(t,Ba(t,r)).on("end.style."+t,Un(t)):typeof e=="function"?this.styleTween(t,Ya(t,r,Le(this,"style."+t,e))).each(qa(this._id,t)):this.styleTween(t,Va(t,r,e),n).on("end.style."+t,null)}function Ga(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function Ua(t,e,n){var r,i;function o(){var a=e.apply(this,arguments);return a!==i&&(r=(i=a)&&Ga(t,a,n)),r}return o._value=e,o}function Ka(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Ua(t,e,n??""))}function Za(t){return function(){this.textContent=t}}function Qa(t){return function(){var e=t(this);this.textContent=e??""}}function Ja(t){return this.tween("text",typeof t=="function"?Qa(Le(this,"text",t)):Za(t==null?"":t+""))}function ja(t){return function(e){this.textContent=t.call(this,e)}}function ts(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&ja(i)),e}return r._value=t,r}function es(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,ts(t))}function ns(){for(var t=this._name,e=this._id,n=Kn(),r=this._groups,i=r.length,o=0;o<i;++o)for(var a=r[o],u=a.length,f,s=0;s<u;++s)if(f=a[s]){var c=at(f,e);he(f,t,n,s,a,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new dt(r,this._parents,t,n)}function rs(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(o,a){var u={value:a},f={value:function(){--i===0&&o()}};n.each(function(){var s=ct(this,r),c=s.on;c!==t&&(e=(t=c).copy(),e._.cancel.push(u),e._.interrupt.push(u),e._.end.push(f)),s.on=e}),i===0&&o()})}var is=0;function dt(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Kn(){return++is}var lt=Ot.prototype;dt.prototype={constructor:dt,select:Xa,selectAll:Fa,selectChild:lt.selectChild,selectChildren:lt.selectChildren,filter:Ca,merge:Ia,selection:Oa,transition:ns,call:lt.call,nodes:lt.nodes,node:lt.node,size:lt.size,empty:lt.empty,each:lt.each,on:Da,attr:pa,attrTween:wa,style:Wa,styleTween:Ka,text:Ja,textTween:es,remove:Pa,tween:ua,delay:Ma,duration:Aa,ease:Ea,easeVarying:za,end:rs,[Symbol.iterator]:lt[Symbol.iterator]};function os(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var as={time:null,delay:0,duration:250,ease:os};function ss(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function us(t){var e,n;t instanceof dt?(e=t._id,t=t._name):(e=Kn(),(n=as).time=Pe(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var a=r[o],u=a.length,f,s=0;s<u;++s)(f=a[s])&&he(f,t,e,s,a,n||ss(f,e));return new dt(r,this._parents,t,e)}Ot.prototype.interrupt=oa;Ot.prototype.transition=us;function gn(t,e){var n,r=1;t==null&&(t=0),e==null&&(e=0);function i(){var o,a=n.length,u,f=0,s=0;for(o=0;o<a;++o)u=n[o],f+=u.x,s+=u.y;for(f=(f/a-t)*r,s=(s/a-e)*r,o=0;o<a;++o)u=n[o],u.x-=f,u.y-=s}return i.initialize=function(o){n=o},i.x=function(o){return arguments.length?(t=+o,i):t},i.y=function(o){return arguments.length?(e=+o,i):e},i.strength=function(o){return arguments.length?(r=+o,i):r},i}function cs(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Zn(this.cover(e,n),e,n,t)}function Zn(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,o=t._root,a={data:r},u=t._x0,f=t._y0,s=t._x1,c=t._y1,v,h,d,_,y,l,g,b;if(!o)return t._root=a,t;for(;o.length;)if((y=e>=(v=(u+s)/2))?u=v:s=v,(l=n>=(h=(f+c)/2))?f=h:c=h,i=o,!(o=o[g=l<<1|y]))return i[g]=a,t;if(d=+t._x.call(null,o.data),_=+t._y.call(null,o.data),e===d&&n===_)return a.next=o,i?i[g]=a:t._root=a,t;do i=i?i[g]=new Array(4):t._root=new Array(4),(y=e>=(v=(u+s)/2))?u=v:s=v,(l=n>=(h=(f+c)/2))?f=h:c=h;while((g=l<<1|y)===(b=(_>=h)<<1|d>=v));return i[b]=o,i[g]=a,t}function fs(t){var e,n,r=t.length,i,o,a=new Array(r),u=new Array(r),f=1/0,s=1/0,c=-1/0,v=-1/0;for(n=0;n<r;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(o=+this._y.call(null,e))||(a[n]=i,u[n]=o,i<f&&(f=i),i>c&&(c=i),o<s&&(s=o),o>v&&(v=o));if(f>c||s>v)return this;for(this.cover(f,s).cover(c,v),n=0;n<r;++n)Zn(this,a[n],u[n],t[n]);return this}function ls(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,o=(r=Math.floor(e))+1;else{for(var a=i-n||1,u=this._root,f,s;n>t||t>=i||r>e||e>=o;)switch(s=(e<r)<<1|t<n,f=new Array(4),f[s]=u,u=f,a*=2,s){case 0:i=n+a,o=r+a;break;case 1:n=i-a,o=r+a;break;case 2:i=n+a,r=o-a;break;case 3:n=i-a,r=o-a;break}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=r,this._x1=i,this._y1=o,this}function hs(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function gs(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Z(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function ds(t,e,n){var r,i=this._x0,o=this._y0,a,u,f,s,c=this._x1,v=this._y1,h=[],d=this._root,_,y;for(d&&h.push(new Z(d,i,o,c,v)),n==null?n=1/0:(i=t-n,o=e-n,c=t+n,v=e+n,n*=n);_=h.pop();)if(!(!(d=_.node)||(a=_.x0)>c||(u=_.y0)>v||(f=_.x1)<i||(s=_.y1)<o))if(d.length){var l=(a+f)/2,g=(u+s)/2;h.push(new Z(d[3],l,g,f,s),new Z(d[2],a,g,l,s),new Z(d[1],l,u,f,g),new Z(d[0],a,u,l,g)),(y=(e>=g)<<1|t>=l)&&(_=h[h.length-1],h[h.length-1]=h[h.length-1-y],h[h.length-1-y]=_)}else{var b=t-+this._x.call(null,d.data),S=e-+this._y.call(null,d.data),p=b*b+S*S;if(p<n){var k=Math.sqrt(n=p);i=t-k,o=e-k,c=t+k,v=e+k,r=d.data}}return r}function ps(t){if(isNaN(c=+this._x.call(null,t))||isNaN(v=+this._y.call(null,t)))return this;var e,n=this._root,r,i,o,a=this._x0,u=this._y0,f=this._x1,s=this._y1,c,v,h,d,_,y,l,g;if(!n)return this;if(n.length)for(;;){if((_=c>=(h=(a+f)/2))?a=h:f=h,(y=v>=(d=(u+s)/2))?u=d:s=d,e=n,!(n=n[l=y<<1|_]))return this;if(!n.length)break;(e[l+1&3]||e[l+2&3]||e[l+3&3])&&(r=e,g=l)}for(;n.data!==t;)if(i=n,!(n=n.next))return this;return(o=n.next)&&delete n.next,i?(o?i.next=o:delete i.next,this):e?(o?e[l]=o:delete e[l],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(r?r[g]=n:this._root=n),this):(this._root=o,this)}function ms(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function ys(){return this._root}function vs(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function _s(t){var e=[],n,r=this._root,i,o,a,u,f;for(r&&e.push(new Z(r,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(r=n.node,o=n.x0,a=n.y0,u=n.x1,f=n.y1)&&r.length){var s=(o+u)/2,c=(a+f)/2;(i=r[3])&&e.push(new Z(i,s,c,u,f)),(i=r[2])&&e.push(new Z(i,o,c,s,f)),(i=r[1])&&e.push(new Z(i,s,a,u,c)),(i=r[0])&&e.push(new Z(i,o,a,s,c))}return this}function ws(t){var e=[],n=[],r;for(this._root&&e.push(new Z(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var i=r.node;if(i.length){var o,a=r.x0,u=r.y0,f=r.x1,s=r.y1,c=(a+f)/2,v=(u+s)/2;(o=i[0])&&e.push(new Z(o,a,u,c,v)),(o=i[1])&&e.push(new Z(o,c,u,f,v)),(o=i[2])&&e.push(new Z(o,a,v,c,s)),(o=i[3])&&e.push(new Z(o,c,v,f,s))}n.push(r)}for(;r=n.pop();)t(r.node,r.x0,r.y0,r.x1,r.y1);return this}function xs(t){return t[0]}function bs(t){return arguments.length?(this._x=t,this):this._x}function Ms(t){return t[1]}function Ns(t){return arguments.length?(this._y=t,this):this._y}function Oe(t,e,n){var r=new Be(e??xs,n??Ms,NaN,NaN,NaN,NaN);return t==null?r:r.addAll(t)}function Be(t,e,n,r,i,o){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function dn(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Q=Oe.prototype=Be.prototype;Q.copy=function(){var t=new Be(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,r;if(!e)return t;if(!e.length)return t._root=dn(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var i=0;i<4;++i)(r=e.source[i])&&(r.length?n.push({source:r,target:e.target[i]=new Array(4)}):e.target[i]=dn(r));return t};Q.add=cs;Q.addAll=fs;Q.cover=ls;Q.data=hs;Q.extent=gs;Q.find=ds;Q.remove=ps;Q.removeAll=ms;Q.root=ys;Q.size=vs;Q.visit=_s;Q.visitAfter=ws;Q.x=bs;Q.y=Ns;function xt(t){return function(){return t}}function yt(t){return(t()-.5)*1e-6}function ks(t){return t.x+t.vx}function As(t){return t.y+t.vy}function Ss(t){var e,n,r,i=1,o=1;typeof t!="function"&&(t=xt(t==null?1:+t));function a(){for(var s,c=e.length,v,h,d,_,y,l,g=0;g<o;++g)for(v=Oe(e,ks,As).visitAfter(u),s=0;s<c;++s)h=e[s],y=n[h.index],l=y*y,d=h.x+h.vx,_=h.y+h.vy,v.visit(b);function b(S,p,k,M,N){var z=S.data,L=S.r,P=y+L;if(z){if(z.index>h.index){var O=d-z.x-z.vx,Y=_-z.y-z.vy,W=O*O+Y*Y;W<P*P&&(O===0&&(O=yt(r),W+=O*O),Y===0&&(Y=yt(r),W+=Y*Y),W=(P-(W=Math.sqrt(W)))/W*i,h.vx+=(O*=W)*(P=(L*=L)/(l+L)),h.vy+=(Y*=W)*P,z.vx-=O*(P=1-P),z.vy-=Y*P)}return}return p>d+P||M<d-P||k>_+P||N<_-P}}function u(s){if(s.data)return s.r=n[s.data.index];for(var c=s.r=0;c<4;++c)s[c]&&s[c].r>s.r&&(s.r=s[c].r)}function f(){if(e){var s,c=e.length,v;for(n=new Array(c),s=0;s<c;++s)v=e[s],n[v.index]=+t(v,s,e)}}return a.initialize=function(s,c){e=s,r=c,f()},a.iterations=function(s){return arguments.length?(o=+s,a):o},a.strength=function(s){return arguments.length?(i=+s,a):i},a.radius=function(s){return arguments.length?(t=typeof s=="function"?s:xt(+s),f(),a):t},a}function Es(t){return t.index}function pn(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function Ts(t){var e=Es,n=v,r,i=xt(30),o,a,u,f,s,c=1;t==null&&(t=[]);function v(l){return 1/Math.min(u[l.source.index],u[l.target.index])}function h(l){for(var g=0,b=t.length;g<c;++g)for(var S=0,p,k,M,N,z,L,P;S<b;++S)p=t[S],k=p.source,M=p.target,N=M.x+M.vx-k.x-k.vx||yt(s),z=M.y+M.vy-k.y-k.vy||yt(s),L=Math.sqrt(N*N+z*z),L=(L-o[S])/L*l*r[S],N*=L,z*=L,M.vx-=N*(P=f[S]),M.vy-=z*P,k.vx+=N*(P=1-P),k.vy+=z*P}function d(){if(a){var l,g=a.length,b=t.length,S=new Map(a.map((k,M)=>[e(k,M,a),k])),p;for(l=0,u=new Array(g);l<b;++l)p=t[l],p.index=l,typeof p.source!="object"&&(p.source=pn(S,p.source)),typeof p.target!="object"&&(p.target=pn(S,p.target)),u[p.source.index]=(u[p.source.index]||0)+1,u[p.target.index]=(u[p.target.index]||0)+1;for(l=0,f=new Array(b);l<b;++l)p=t[l],f[l]=u[p.source.index]/(u[p.source.index]+u[p.target.index]);r=new Array(b),_(),o=new Array(b),y()}}function _(){if(a)for(var l=0,g=t.length;l<g;++l)r[l]=+n(t[l],l,t)}function y(){if(a)for(var l=0,g=t.length;l<g;++l)o[l]=+i(t[l],l,t)}return h.initialize=function(l,g){a=l,s=g,d()},h.links=function(l){return arguments.length?(t=l,d(),h):t},h.id=function(l){return arguments.length?(e=l,h):e},h.iterations=function(l){return arguments.length?(c=+l,h):c},h.strength=function(l){return arguments.length?(n=typeof l=="function"?l:xt(+l),_(),h):n},h.distance=function(l){return arguments.length?(i=typeof l=="function"?l:xt(+l),y(),h):i},h}const zs=1664525,Cs=1013904223,mn=4294967296;function Is(){let t=1;return()=>(t=(zs*t+Cs)%mn)/mn}function $s(t){return t.x}function Rs(t){return t.y}var Ds=10,Hs=Math.PI*(3-Math.sqrt(5));function Ps(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),o=0,a=.6,u=new Map,f=Xe(v),s=Lt("tick","end"),c=Is();t==null&&(t=[]);function v(){h(),s.call("tick",e),n<r&&(f.stop(),s.call("end",e))}function h(y){var l,g=t.length,b;y===void 0&&(y=1);for(var S=0;S<y;++S)for(n+=(o-n)*i,u.forEach(function(p){p(n)}),l=0;l<g;++l)b=t[l],b.fx==null?b.x+=b.vx*=a:(b.x=b.fx,b.vx=0),b.fy==null?b.y+=b.vy*=a:(b.y=b.fy,b.vy=0);return e}function d(){for(var y=0,l=t.length,g;y<l;++y){if(g=t[y],g.index=y,g.fx!=null&&(g.x=g.fx),g.fy!=null&&(g.y=g.fy),isNaN(g.x)||isNaN(g.y)){var b=Ds*Math.sqrt(.5+y),S=y*Hs;g.x=b*Math.cos(S),g.y=b*Math.sin(S)}(isNaN(g.vx)||isNaN(g.vy))&&(g.vx=g.vy=0)}}function _(y){return y.initialize&&y.initialize(t,c),y}return d(),e={tick:h,restart:function(){return f.restart(v),e},stop:function(){return f.stop(),e},nodes:function(y){return arguments.length?(t=y,d(),u.forEach(_),e):t},alpha:function(y){return arguments.length?(n=+y,e):n},alphaMin:function(y){return arguments.length?(r=+y,e):r},alphaDecay:function(y){return arguments.length?(i=+y,e):+i},alphaTarget:function(y){return arguments.length?(o=+y,e):o},velocityDecay:function(y){return arguments.length?(a=1-y,e):1-a},randomSource:function(y){return arguments.length?(c=y,u.forEach(_),e):c},force:function(y,l){return arguments.length>1?(l==null?u.delete(y):u.set(y,_(l)),e):u.get(y)},find:function(y,l,g){var b=0,S=t.length,p,k,M,N,z;for(g==null?g=1/0:g*=g,b=0;b<S;++b)N=t[b],p=y-N.x,k=l-N.y,M=p*p+k*k,M<g&&(z=N,g=M);return z},on:function(y,l){return arguments.length>1?(s.on(y,l),e):s.on(y)}}}function Xs(){var t,e,n,r,i=xt(-30),o,a=1,u=1/0,f=.81;function s(d){var _,y=t.length,l=Oe(t,$s,Rs).visitAfter(v);for(r=d,_=0;_<y;++_)e=t[_],l.visit(h)}function c(){if(t){var d,_=t.length,y;for(o=new Array(_),d=0;d<_;++d)y=t[d],o[y.index]=+i(y,d,t)}}function v(d){var _=0,y,l,g=0,b,S,p;if(d.length){for(b=S=p=0;p<4;++p)(y=d[p])&&(l=Math.abs(y.value))&&(_+=y.value,g+=l,b+=l*y.x,S+=l*y.y);d.x=b/g,d.y=S/g}else{y=d,y.x=y.data.x,y.y=y.data.y;do _+=o[y.data.index];while(y=y.next)}d.value=_}function h(d,_,y,l){if(!d.value)return!0;var g=d.x-e.x,b=d.y-e.y,S=l-_,p=g*g+b*b;if(S*S/f<p)return p<u&&(g===0&&(g=yt(n),p+=g*g),b===0&&(b=yt(n),p+=b*b),p<a&&(p=Math.sqrt(a*p)),e.vx+=g*d.value*r/p,e.vy+=b*d.value*r/p),!0;if(d.length||p>=u)return;(d.data!==e||d.next)&&(g===0&&(g=yt(n),p+=g*g),b===0&&(b=yt(n),p+=b*b),p<a&&(p=Math.sqrt(a*p)));do d.data!==e&&(S=o[d.data.index]*r/p,e.vx+=g*S,e.vy+=b*S);while(d=d.next)}return s.initialize=function(d,_){t=d,n=_,c()},s.strength=function(d){return arguments.length?(i=typeof d=="function"?d:xt(+d),c(),s):i},s.distanceMin=function(d){return arguments.length?(a=d*d,s):Math.sqrt(a)},s.distanceMax=function(d){return arguments.length?(u=d*d,s):Math.sqrt(u)},s.theta=function(d){return arguments.length?(f=d*d,s):Math.sqrt(f)},s}function Fs(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(r*6,++r*6);return n}const Ls=Fs("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),Zt=t=>()=>t;function Os(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function gt(t,e,n){this.k=t,this.x=e,this.y=n}gt.prototype={constructor:gt,scale:function(t){return t===1?this:new gt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new gt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ve=new gt(1,0,0);gt.prototype;function be(t){t.stopImmediatePropagation()}function Ct(t){t.preventDefault(),t.stopImmediatePropagation()}function Bs(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function Vs(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function yn(){return this.__zoom||Ve}function Ys(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function qs(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ws(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],a=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),a>o?(o+a)/2:Math.min(0,o)||Math.max(0,a))}function Gs(){var t=Bs,e=Vs,n=Ws,r=Ys,i=qs,o=[0,1/0],a=[[-1/0,-1/0],[1/0,1/0]],u=250,f=Qo,s=Lt("start","zoom","end"),c,v,h,d=500,_=150,y=0,l=10;function g(m){m.property("__zoom",yn).on("wheel.zoom",z,{passive:!1}).on("mousedown.zoom",L).on("dblclick.zoom",P).filter(i).on("touchstart.zoom",O).on("touchmove.zoom",Y).on("touchend.zoom touchcancel.zoom",W).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}g.transform=function(m,E,x,T){var $=m.selection?m.selection():m;$.property("__zoom",yn),m!==$?k(m,E,x,T):$.interrupt().each(function(){M(this,arguments).event(T).start().zoom(null,typeof E=="function"?E.apply(this,arguments):E).end()})},g.scaleBy=function(m,E,x,T){g.scaleTo(m,function(){var $=this.__zoom.k,D=typeof E=="function"?E.apply(this,arguments):E;return $*D},x,T)},g.scaleTo=function(m,E,x,T){g.transform(m,function(){var $=e.apply(this,arguments),D=this.__zoom,H=x==null?p($):typeof x=="function"?x.apply(this,arguments):x,B=D.invert(H),q=typeof E=="function"?E.apply(this,arguments):E;return n(S(b(D,q),H,B),$,a)},x,T)},g.translateBy=function(m,E,x,T){g.transform(m,function(){return n(this.__zoom.translate(typeof E=="function"?E.apply(this,arguments):E,typeof x=="function"?x.apply(this,arguments):x),e.apply(this,arguments),a)},null,T)},g.translateTo=function(m,E,x,T,$){g.transform(m,function(){var D=e.apply(this,arguments),H=this.__zoom,B=T==null?p(D):typeof T=="function"?T.apply(this,arguments):T;return n(Ve.translate(B[0],B[1]).scale(H.k).translate(typeof E=="function"?-E.apply(this,arguments):-E,typeof x=="function"?-x.apply(this,arguments):-x),D,a)},T,$)};function b(m,E){return E=Math.max(o[0],Math.min(o[1],E)),E===m.k?m:new gt(E,m.x,m.y)}function S(m,E,x){var T=E[0]-x[0]*m.k,$=E[1]-x[1]*m.k;return T===m.x&&$===m.y?m:new gt(m.k,T,$)}function p(m){return[(+m[0][0]+ +m[1][0])/2,(+m[0][1]+ +m[1][1])/2]}function k(m,E,x,T){m.on("start.zoom",function(){M(this,arguments).event(T).start()}).on("interrupt.zoom end.zoom",function(){M(this,arguments).event(T).end()}).tween("zoom",function(){var $=this,D=arguments,H=M($,D).event(T),B=e.apply($,D),q=x==null?p(B):typeof x=="function"?x.apply($,D):x,tt=Math.max(B[1][0]-B[0][0],B[1][1]-B[0][1]),U=$.__zoom,et=typeof E=="function"?E.apply($,D):E,it=f(U.invert(q).concat(tt/U.k),et.invert(q).concat(tt/et.k));return function(A){if(A===1)A=et;else{var C=it(A),V=tt/C[2];A=new gt(V,q[0]-C[0]*V,q[1]-C[1]*V)}H.zoom(null,A)}})}function M(m,E,x){return!x&&m.__zooming||new N(m,E)}function N(m,E){this.that=m,this.args=E,this.active=0,this.sourceEvent=null,this.extent=e.apply(m,E),this.taps=0}N.prototype={event:function(m){return m&&(this.sourceEvent=m),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(m,E){return this.mouse&&m!=="mouse"&&(this.mouse[1]=E.invert(this.mouse[0])),this.touch0&&m!=="touch"&&(this.touch0[1]=E.invert(this.touch0[0])),this.touch1&&m!=="touch"&&(this.touch1[1]=E.invert(this.touch1[0])),this.that.__zoom=E,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(m){var E=J(this.that).datum();s.call(m,this.that,new Os(m,{sourceEvent:this.sourceEvent,target:g,transform:this.that.__zoom,dispatch:s}),E)}};function z(m,...E){if(!t.apply(this,arguments))return;var x=M(this,E).event(m),T=this.__zoom,$=Math.max(o[0],Math.min(o[1],T.k*Math.pow(2,r.apply(this,arguments)))),D=ht(m);if(x.wheel)(x.mouse[0][0]!==D[0]||x.mouse[0][1]!==D[1])&&(x.mouse[1]=T.invert(x.mouse[0]=D)),clearTimeout(x.wheel);else{if(T.k===$)return;x.mouse=[D,T.invert(D)],ee(this),x.start()}Ct(m),x.wheel=setTimeout(H,_),x.zoom("mouse",n(S(b(T,$),x.mouse[0],x.mouse[1]),x.extent,a));function H(){x.wheel=null,x.end()}}function L(m,...E){if(h||!t.apply(this,arguments))return;var x=m.currentTarget,T=M(this,E,!0).event(m),$=J(m.view).on("mousemove.zoom",q,!0).on("mouseup.zoom",tt,!0),D=ht(m,x),H=m.clientX,B=m.clientY;Hn(m.view),be(m),T.mouse=[D,this.__zoom.invert(D)],ee(this),T.start();function q(U){if(Ct(U),!T.moved){var et=U.clientX-H,it=U.clientY-B;T.moved=et*et+it*it>y}T.event(U).zoom("mouse",n(S(T.that.__zoom,T.mouse[0]=ht(U,x),T.mouse[1]),T.extent,a))}function tt(U){$.on("mousemove.zoom mouseup.zoom",null),Pn(U.view,T.moved),Ct(U),T.event(U).end()}}function P(m,...E){if(t.apply(this,arguments)){var x=this.__zoom,T=ht(m.changedTouches?m.changedTouches[0]:m,this),$=x.invert(T),D=x.k*(m.shiftKey?.5:2),H=n(S(b(x,D),T,$),e.apply(this,E),a);Ct(m),u>0?J(this).transition().duration(u).call(k,H,T,m):J(this).call(g.transform,H,T,m)}}function O(m,...E){if(t.apply(this,arguments)){var x=m.touches,T=x.length,$=M(this,E,m.changedTouches.length===T).event(m),D,H,B,q;for(be(m),H=0;H<T;++H)B=x[H],q=ht(B,this),q=[q,this.__zoom.invert(q),B.identifier],$.touch0?!$.touch1&&$.touch0[2]!==q[2]&&($.touch1=q,$.taps=0):($.touch0=q,D=!0,$.taps=1+!!c);c&&(c=clearTimeout(c)),D&&($.taps<2&&(v=q[0],c=setTimeout(function(){c=null},d)),ee(this),$.start())}}function Y(m,...E){if(this.__zooming){var x=M(this,E).event(m),T=m.changedTouches,$=T.length,D,H,B,q;for(Ct(m),D=0;D<$;++D)H=T[D],B=ht(H,this),x.touch0&&x.touch0[2]===H.identifier?x.touch0[0]=B:x.touch1&&x.touch1[2]===H.identifier&&(x.touch1[0]=B);if(H=x.that.__zoom,x.touch1){var tt=x.touch0[0],U=x.touch0[1],et=x.touch1[0],it=x.touch1[1],A=(A=et[0]-tt[0])*A+(A=et[1]-tt[1])*A,C=(C=it[0]-U[0])*C+(C=it[1]-U[1])*C;H=b(H,Math.sqrt(A/C)),B=[(tt[0]+et[0])/2,(tt[1]+et[1])/2],q=[(U[0]+it[0])/2,(U[1]+it[1])/2]}else if(x.touch0)B=x.touch0[0],q=x.touch0[1];else return;x.zoom("touch",n(S(H,B,q),x.extent,a))}}function W(m,...E){if(this.__zooming){var x=M(this,E).event(m),T=m.changedTouches,$=T.length,D,H;for(be(m),h&&clearTimeout(h),h=setTimeout(function(){h=null},d),D=0;D<$;++D)H=T[D],x.touch0&&x.touch0[2]===H.identifier?delete x.touch0:x.touch1&&x.touch1[2]===H.identifier&&delete x.touch1;if(x.touch1&&!x.touch0&&(x.touch0=x.touch1,delete x.touch1),x.touch0)x.touch0[1]=this.__zoom.invert(x.touch0[0]);else if(x.end(),x.taps===2&&(H=ht(H,this),Math.hypot(v[0]-H[0],v[1]-H[1])<l)){var B=J(this).on("dblclick.zoom");B&&B.apply(this,arguments)}}}return g.wheelDelta=function(m){return arguments.length?(r=typeof m=="function"?m:Zt(+m),g):r},g.filter=function(m){return arguments.length?(t=typeof m=="function"?m:Zt(!!m),g):t},g.touchable=function(m){return arguments.length?(i=typeof m=="function"?m:Zt(!!m),g):i},g.extent=function(m){return arguments.length?(e=typeof m=="function"?m:Zt([[+m[0][0],+m[0][1]],[+m[1][0],+m[1][1]]]),g):e},g.scaleExtent=function(m){return arguments.length?(o[0]=+m[0],o[1]=+m[1],g):[o[0],o[1]]},g.translateExtent=function(m){return arguments.length?(a[0][0]=+m[0][0],a[1][0]=+m[1][0],a[0][1]=+m[0][1],a[1][1]=+m[1][1],g):[[a[0][0],a[0][1]],[a[1][0],a[1][1]]]},g.constrain=function(m){return arguments.length?(n=m,g):n},g.duration=function(m){return arguments.length?(u=+m,g):u},g.interpolate=function(m){return arguments.length?(f=m,g):f},g.on=function(){var m=s.on.apply(s,arguments);return m===s?g:m},g.clickDistance=function(m){return arguments.length?(y=(m=+m)*m,g):Math.sqrt(y)},g.tapDistance=function(m){return arguments.length?(l=+m,g):l},g}var Us=Nr('<div class="network-container w-full h-full bg-gray-50 rounded-lg border border-gray-200"></div>');function ru(t,e){_r(e,!1);let n=nt(e,"items",24,()=>[]),r=nt(e,"neighbors",24,()=>({})),i=nt(e,"onNodeClick",8,()=>{}),o=nt(e,"onNodeHover",8,()=>{}),a=nt(e,"onEdgeClick",8,()=>{}),u=nt(e,"selectedId",8,null),f=nt(e,"maxNodes",8,500),s=nt(e,"minScore",8,.02),c=nt(e,"userSimilarity",24,()=>new Map),v=nt(e,"textWeight",8,.6),h=nt(e,"dateWeight",8,.2),d=nt(e,"placeWeight",8,.2),_=nt(e,"userWeight",8,0),y=Qt(),l=Qt(),g=Qt(),b=[],S=[],p=new Map,k=Ls,M=1200,N=700,z;function L(){if(!R(y)||!R(l))return;const A=R(y).getBoundingClientRect();M=Math.max(320,Math.floor(A.width)),N=Math.max(400,N),R(l).attr("width",M).attr("height",N).attr("viewBox",[0,0,M,N])}function P(){L(),R(g)&&R(g).force("center",gn(M/2,N/2)).alpha(.2).restart()}let O=null;wr(()=>{Y(),L(),typeof window<"u"&&(window.addEventListener("resize",P),O=()=>window.removeEventListener("resize",P))}),typeof window<"u"&&xr(()=>{R(g)&&R(g).stop(),O&&O()});function Y(){ye(l,J(R(y)).append("svg").attr("width",M).attr("height",N).attr("viewBox",[0,0,M,N]).attr("style","max-width: 100%; height: auto;")),R(l).on("click",function(A){(A.target===this||A.target.tagName==="svg")&&i()("")}),z=Gs().scaleExtent([.1,10]).on("zoom",A=>{R(l).select(".graph-container").attr("transform",A.transform)}),R(l).call(z),R(l).append("g").attr("class","graph-container")}function W(){if(!R(l))return;const A=new Set,C=[];n().slice(0,f()).forEach(w=>{A.add(w.id)}),Object.entries(r()).forEach(([w,I])=>{A.has(w)&&I.forEach(X=>{A.has(X.id)&&X.score>=s()&&C.push({source:w,target:X.id,score:X.score,baseScore:X.score,S_text:X.S_text,S_date:X.S_date,S_place:X.S_place})})}),b=Array.from(A).map(w=>{const I=n().find(X=>X.id===w);return{id:w,title:Array.isArray(I?.title)?I.title[0]:I?.title||w,year:I?.year,type:I?.type,collection:I?.collection,degree:0,cluster:0}});const G=new Map;C.forEach(w=>{const I=typeof w.source=="string"?w.source:w.source.id,X=typeof w.target=="string"?w.target:w.target.id;G.set(I,(G.get(I)||0)+1),G.set(X,(G.get(X)||0)+1)}),b.forEach(w=>{w.degree=G.get(w.id)||0}),S=C,E(),x(),$()}function m(A,C){return[A,C].sort().join("|")}function E(){if(S)for(const A of S){const C=typeof A.source=="string"?A.source:A.source.id,V=typeof A.target=="string"?A.target:A.target.id,G=(A.S_text??0)*v(),w=(A.S_date??0)*h(),I=(A.S_place??0)*d(),F=(c()?.get(m(C,V))??0)*_(),K=G+w+I+F,pt=Math.max(0,Math.min(1,K));A.score=pt}}function x(){const A=new Map;S.forEach(w=>{const I=typeof w.source=="string"?w.source:w.source.id,X=typeof w.target=="string"?w.target:w.target.id,F=Number.isFinite(w.score)?w.score:1;A.has(I)||A.set(I,new Map),A.has(X)||A.set(X,new Map),A.get(I).set(X,(A.get(I).get(X)||0)+F),A.get(X).set(I,(A.get(X).get(I)||0)+F)});const C=T(A,40);p.clear();const V=new Map;let G=0;for(const w of b){const I=C.get(w.id)||w.id;V.has(I)||V.set(I,G++),p.set(w.id,V.get(I))}b.forEach(w=>{w.cluster=p.get(w.id)||0})}function T(A,C=30){const V=new Map,G=b.map(w=>w.id);for(const w of G)V.set(w,w);for(let w=0;w<C;w++){let I=0;const X=G.slice();for(let F=X.length-1;F>0;F--){const K=Math.floor(Math.random()*(F+1));[X[F],X[K]]=[X[K],X[F]]}for(const F of X){const K=A.get(F);if(!K||K.size===0)continue;const pt=new Map;K.forEach((St,Et)=>{const Ye=V.get(Et)||Et;pt.set(Ye,(pt.get(Ye)||0)+St)});let Vt=V.get(F)||F,ge=-1/0;pt.forEach((St,Et)=>{(St>ge||St===ge&&Et<Vt)&&(ge=St,Vt=Et)}),Vt!==V.get(F)&&(V.set(F,Vt),I++)}if(I===0)break}return V}function $(){const A=R(l).select(".graph-container");A.selectAll("*").remove();const C=A.append("g").attr("class","links").selectAll("line").data(S).join("line").attr("stroke","#999").attr("stroke-opacity",w=>.2+w.score*.6).attr("stroke-width",w=>Math.max(.5,w.score*3)).attr("cursor","pointer").on("click",(w,I)=>{w.stopPropagation();const X=typeof I.source=="string"?I.source:I.source.id,F=typeof I.target=="string"?I.target:I.target.id;a()(X,F)}).on("mouseover",function(){J(this).attr("stroke","#0066cc").attr("stroke-width",w=>Math.max(2,w.score*4))}).on("mouseout",function(){J(this).attr("stroke","#999").attr("stroke-width",w=>Math.max(.5,w.score*3))}),V=A.append("g").attr("class","nodes").selectAll("g").data(b).join("g").attr("cursor","pointer").call(H(R(g)));V.append("circle").attr("r",w=>Math.max(3,Math.min(15,3+Math.sqrt(w.degree)))).attr("fill",w=>k[w.cluster%k.length]).attr("stroke","#fff").attr("stroke-width",1.5).on("click",(w,I)=>{w.stopPropagation(),i()(I.id)}).on("mouseover",function(w,I){J(this).attr("stroke","#000").attr("stroke-width",2);try{o()(I.id)}catch{}const X=A.append("g").attr("class","tooltip").attr("transform",`translate(${I.x},${I.y})`),F=X.append("text").attr("dy",-20).attr("text-anchor","middle").style("font-size","12px").style("font-weight","bold").style("fill","#000").style("pointer-events","none");F.append("tspan").text(I.title.substring(0,50)+(I.title.length>50?"...":""));const K=F.node().getBBox();X.insert("rect","text").attr("x",K.x-4).attr("y",K.y-2).attr("width",K.width+8).attr("height",K.height+4).attr("fill","white").attr("stroke","#000").attr("rx",3)}).on("mouseout",function(){J(this).attr("stroke","#fff").attr("stroke-width",1.5),A.selectAll(".tooltip").remove();try{o()(null)}catch{}}),V.filter(w=>w.degree>5).append("text").attr("dx",8).attr("dy",3).style("font-size","8px").style("fill","#333").style("pointer-events","none").text(w=>w.title.substring(0,20)),ye(g,Ps(b).force("link",Ts(S).id(w=>w.id).distance(w=>100-w.score*50).strength(w=>w.score)).force("charge",Xs().strength(-30).distanceMax(200)).force("cluster",D()).force("collision",Ss().radius(w=>Math.max(3,Math.min(15,3+Math.sqrt(w.degree)))+2)).force("center",gn(M/2,N/2)).on("tick",G));function G(){C.attr("x1",w=>w.source.x).attr("y1",w=>w.source.y).attr("x2",w=>w.target.x).attr("y2",w=>w.target.y),V.attr("transform",w=>`translate(${w.x},${w.y})`)}}function D(){let A;const V=M/2,G=N/2;function w(I){const X=new Map;A.forEach(F=>{if(!X.has(F.cluster)){const K=F.cluster/10*2*Math.PI,pt=200;X.set(F.cluster,{x:V+Math.cos(K)*pt,y:G+Math.sin(K)*pt,count:0})}}),A.forEach(F=>{const K=X.get(F.cluster);K&&F.x!==void 0&&F.y!==void 0&&(F.vx=(F.vx||0)+(K.x-F.x)*.3*I,F.vy=(F.vy||0)+(K.y-F.y)*.3*I)})}return w.initialize=function(I){A=I},w}function H(A){function C(w){w.active||A.alphaTarget(.3).restart(),w.subject.fx=w.subject.x,w.subject.fy=w.subject.y}function V(w){w.subject.fx=w.x,w.subject.fy=w.y}function G(w){w.active||A.alphaTarget(0),w.subject.fx=null,w.subject.fy=null}return ko().on("start",C).on("drag",V).on("end",G)}function B(){if(!R(l)||!u())return;const A=new Set;A.add(u()),S.forEach(C=>{const V=typeof C.source=="string"?C.source:C.source.id,G=typeof C.target=="string"?C.target:C.target.id;V===u()&&A.add(G),G===u()&&A.add(V)}),R(l).select(".nodes").selectAll("g").attr("opacity",C=>A.has(C.id)?1:.15),R(l).select(".nodes").selectAll("circle").attr("stroke",C=>C.id===u()?"#ff0000":"#fff").attr("stroke-width",C=>C.id===u()?3:1.5),R(l).select(".links").selectAll("line").attr("stroke",C=>C.source.id===u()||C.target.id===u()?"#ff6b6b":"#999").attr("stroke-opacity",C=>C.source.id===u()||C.target.id===u()?.9:.08)}function q(){R(l)&&(R(l).select(".nodes").selectAll("g").attr("opacity",1),R(l).select(".nodes").selectAll("circle").attr("stroke","#fff").attr("stroke-width",1.5),R(l).select(".links").selectAll("line").attr("stroke","#999").attr("stroke-opacity",A=>.2+A.score*.6))}function tt(){R(l)&&z&&R(l).transition().duration(750).call(z.transform,Ve)}function U(){R(g)&&R(g).alpha(1).restart()}Yt(()=>(R(y),ft(n()),ft(r())),()=>{R(y)&&n().length>0&&r()&&W()}),Yt(()=>(R(l),ft(f())),()=>{R(l)&&f()&&W()}),Yt(()=>(R(l),ft(u())),()=>{R(l)&&(u()?B():q())}),Yt(()=>(R(g),R(l),ft(v()),ft(h()),ft(d()),ft(_()),ft(c())),()=>{if(R(g)&&R(l)){v(),h(),d(),_(),c(),E(),x(),R(l).select(".nodes").selectAll("circle").attr("fill",C=>k[(C.cluster??0)%k.length]),R(l).select(".links").selectAll("line").attr("stroke-opacity",C=>.2+C.score*.6).attr("stroke-width",C=>Math.max(.5,C.score*3));const A=R(g).force("link");A&&typeof A.distance=="function"&&typeof A.strength=="function"&&A.distance(C=>100-C.score*50).strength(C=>C.score),R(g).alpha(.6).restart()}}),br();var et={resetZoom:tt,reheat:U};Ar();var it=Us();return Sr(it,A=>ye(y,A),()=>R(y)),kr(t,it),Ue(e,"resetZoom",tt),Ue(e,"reheat",U),Mr(et)}export{ru as N,Ir as a,js as b,Cr as c,nu as d,tu as e,eu as f,zr as i,$r as s,Hr as u};
